---
title: "Produtividade CAPES com regressão"
author: "Lucas Raniére Juvino Santos"
output: html_notebook
---

```{r warning=FALSE, echo=FALSE}
library(tidyverse)
library(broom)
library(modelr)
source(here::here("code/lib.R"))
theme_set(theme_bw())

knitr::opts_chunk$set(tidy = FALSE,
                      fig.width = 6,
                      fig.height = 5)

paleta = c("#404E4D",
           "#92DCE5",
           "#938BA1",
           "#2D3142",
           "#F4743B")
```


## Objetivo

Criar um modelo de regressão linear multivariado para avaliar a produtividade (produção de artigos dividida pelo número de docentes ou o de docentes e discentes), e como ela pode variar em função de outras características dos progrmas de pós graduação em CC do Brasil.

## Dados

```{r}
cacc_tudo = read_projectdata()

glimpse(cacc_tudo)
```

```{r}
cacc = cacc_tudo %>%
  transmute(
    docentes = `Docentes permanentes`,
    producao = (periodicos_A1 + periodicos_A2 + periodicos_B1),
    produtividade = producao / docentes,
    mestrados = Dissertacoes,
    doutorados = Teses,
    tem_doutorado = tolower(`Tem doutorado`) == "sim",
    mestrados_pprof = mestrados / docentes,
    doutorados_pprof = doutorados / docentes
  )

cacc_md = cacc %>% 
  filter(tem_doutorado)
```

```{r}
modelo2 = lm(produtividade ~ mestrados_pprof + doutorados_pprof + docentes, data = cacc)

tidy(modelo2, conf.int = TRUE, conf.level = 0.95)
glance(modelo2)
```
```{r}
para_plotar_modelo = cacc %>% 
  data_grid(produtividade = seq_range(produtividade, 10), # Crie um vetor de 10 valores no range
            docentes = seq_range(docentes, 4),  
            # mestrados = seq_range(mestrados, 3),
            mestrados_pprof = median(mestrados_pprof),
            doutorados_pprof = seq_range(doutorados_pprof, 3)) %>% 
  add_predictions(modelo2)

glimpse(para_plotar_modelo)
```

```{r}
para_plotar_modelo %>% 
  ggplot(aes(x = docentes, y = pred)) + 
  geom_line(aes(group = doutorados_pprof, colour = doutorados_pprof)) + 
  geom_point(data = cacc, aes(y = produtividade, colour = doutorados_pprof))
```

> Regressão múltipla foi utilizada para analisar se VarIndep1 e VarIndep2 tem uma associação significativa com VarDep. Os resultados da regressão indicam que um modelo com os 2 preditores no formato VarDep = XXX.VarIndep1 + YYY.VarIndep2 explicam XX,XX% da variância da variável de resposta (R2 = XX,XX). VarIndep1, medida como/em [unidade ou o que é o 0 e o que é 1] tem uma relação significativa com o erro (b = [yy,yy; zz,zz], IC com 95%), assim como VarIndep2 medida como [unidade ou o que é o 0 e o que é 1] (b = [yy,yy; zz,zz], IC com 95%). O aumento de 1 unidade de VarIndep1 produz uma mudança de xxx em VarDep, enquanto um aumento...