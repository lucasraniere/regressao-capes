---
title: "Produtividade CAPES com regressão"
author: "Lucas Raniére Juvino Santos"
output: html_notebook
---

```{r warning=FALSE, echo=FALSE}
library(tidyverse)
library(broom)
library(modelr)
source(here::here("code/lib.R"))
theme_set(theme_bw())

knitr::opts_chunk$set(tidy = FALSE,
                      fig.width = 6,
                      fig.height = 5)

paleta = c("#404E4D",
           "#92DCE5",
           "#938BA1",
           "#2D3142",
           "#F4743B")
```


## Objetivo

Criar um modelo de regressão linear multivariado para avaliar a produtividade (produção de artigos dividida pelo número de docentes ou o de docentes e discentes), e como ela pode variar em função de outras características dos progrmas de pós graduação em CC do Brasil.

## Dados

```{r}
cacc_tudo = read_projectdata()
```

```{r}
cacc = cacc_tudo %>%
  transmute(
    nota_capes = Nível,
    artigos_conf = `Artigos em conf`,
    docentes = `Docentes permanentes`,
    producao = (periodicos_A1 + periodicos_A2 + periodicos_B1),
    producao_aluno = (per_comaluno_A1 + per_comaluno_A2 + per_comaluno_B1),
    produtividade = producao / docentes,
    prop_paluno = producao_aluno/producao,
    mestrados = Dissertacoes,
    doutorados = Teses,
    tem_doutorado = tolower(`Tem doutorado`) == "sim",
    mestrados_pprof = mestrados / docentes,
    doutorados_pprof = doutorados / docentes
  )
```


```{r}
skimr::skim(cacc)
```



```{r}
modelo = lm(produtividade ~ prop_paluno +  artigos_conf, data = cacc)

tidy(modelo, conf.int = TRUE, conf.level = 0.95)
glance(modelo)
```

> Regressão múltipla foi utilizada para analisar se prop_paluno, nota_capes e artigos_conf tem uma associação significativa com produtividade. Os resultados da regressão indicam que um modelo com os 3 preditores no formato produtividade = -0,511.prop_paluno + 0,569.nota_capes + 0,002.artigos_conf explicam 57,04% da variância da variável de resposta (R2 = 0,57). VarIndep1, medida como/em [unidade ou o que é o 0 e o que é 1] tem uma relação significativa com o erro (b = [yy,yy; zz,zz], IC com 95%), assim como VarIndep2 medida como [unidade ou o que é o 0 e o que é 1] (b = [yy,yy; zz,zz], IC com 95%). O aumento de 1 unidade de VarIndep1 produz uma mudança de xxx em VarDep, enquanto um aumento...

gostaria de relacionar com valor de verba recebida e idade do programa

```{r}
cacc %>%
    ggplot(aes(x = produtividade, y = nota_capes, size = producao, color = doutorados)) +
    geom_point()
```

```{r}
regEq <- function(lmObj, dig) {
    gsub(":", "*", 
        paste0(
            names(lmObj$model)[1]," = ",
            paste0(
                c(round(lmObj$coef[1], dig), round(sign(lmObj$coef[-1])*lmObj$coef[-1], dig)),
                c("", rep("*", length(lmObj$coef)-1)),
                paste0(c("", names(lmObj$coef)[-1]), c(ifelse(sign(lmObj$coef)[-1]==1," + "," - "), "")),
                collapse=""
            )
        )
    )
}

regEq(modelo, 4)
```

